{% extends "base.html" %}
{% block content %}
<style>
  .form .cancel {
    background-color: #148f77;
    margin-left: 88.6%
    }
  .form input[type=text]{
    text-align: center;
    background-color: #eafaf1 ;
    border: none;
    color: black;
  }
   div#myPopup{
    position:absolute;
    left:-4.3%;
    top:31%;
  }
</style>
  <div id="back">
    <div class="container" id="container">
      <div>
        {% if assets or is_history %}
         {% include 'perfiles/tab_price.html' %}
        {% else %}
          <center><h3>No hay activos disponibles para consultar historial</h3></center>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="popup" id="myPopup">
    <form class="form" action="{% url 'assets_history' %}" method="POST"
          id="assets_history_form" onsubmit="name_enable(event)">
      <button class="btn cancel" onclick="ClosePop()"><w>x</w></button><br>
      <b>Elija desde y hasta cuando quedra ver el historial del activo</b><br><br>
      {% csrf_token %}
      {{ form.as_p }}
      <button class="submit">Ver historial</button>
    </form>
  </div>
  {% if is_history %}
    {% if history %}
    <center><h2 id="mj_graph"></h2></center>
    <div style="width:95%; height:95%; position:relative; left:1%;z-index:-1" id="graph">
    </div>
    <center>
    <h2>Historial de {{name_asset}}</h2><br>
    <table>
      <thead>
        <tr><th>Fecha</th><th>Valor de Compra</th><th>Valor de Venta</th></tr>
      </thead>
      <tbody>
       {% for data in history %}
        <tr><td>{{ data.0 }}</td><td>{{ data.1 }}</td><td>{{ data.2 }}</td></tr>
      {% endfor %}
      </tbody>
    </table>
    {% else %}
      <center><h2>No hay datos historicos</h2>
      <h2>para el archivo seleccionado</h2>
    {% endif %}
   <html>
     <head>
      <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
      <script type="text/javascript">
        document.getElementById("prices").style.display = "none";
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChart);
        document.getElementById('mj_graph').innerHTML= "Grafica de valores";
        function drawChart() {
          var djangoData = {{ grap|safe }};
          var data = google.visualization.arrayToDataTable(djangoData);
          var chart = new google.visualization.LineChart(document.getElementById('graph'));
          chart.draw(data);
        }
      </script>
    </head>
  </html>
  <script>
    document.getElementById("no_asset").innerHTML ="";
    document.getElementById("nameC").innerHTML ="";
  </script>
   {% else %}
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js">
  </script>
  <script>
  document.getElementById("nameC").innerHTML = "Activos Disponibles";
  function openForm(value, name) {
    document.getElementById("myPopup").style.display = "block";
    document.getElementById("container").style['pointer-events'] = 'none';
    document.getElementById("container").style.opacity = 0.4;
    document.getElementById("menu_invest").style['pointer-events'] = 'none';
    document.getElementById("menu_invest").style.opacity = 0.4;
    document.getElementById("id_name").value = name;
    document.getElementById("id_name").disabled = true;
    setTimeout("enableDiv()",1);
  }
  function enableDiv() {
    $("#back").click(function() {
    window.location="http://localhost:8000/assetshistory/";
    });
  };
  function ClosePop(){ 
    document.getElementById("container").style['pointer-events'] = 'auto';
    document.getElementById("menu_invest").style['pointer-events'] = 'auto';
    document.getElementById("container").style.opacity = 1;
    document.getElementById("menu_invest").style.opacity = 1;
    document.getElementById("myPopup").style.display = "none";
  }
  function name_enable(event) {
    event.preventDefault();
    var d = new Date();
    var y = d.getFullYear();
    var m = d.getMonth() + 1;
    var d = d.getDate();
    var date = y + "-" + m + "-" + d 
    since = document.getElementById("id_since").value ;
    until = document.getElementById("id_until").value ;
    if(until > date || since > until ) {
      alert("Error fechas ingresadas invalidas");
      document.getElementById("id_since").value = "" ;
      document.getElementById("id_until").value = "" ;
      document.getElementById("id_time_since").value = "" ;
      document.getElementById("id_time_until").value = "" ;
    } else {
      document.getElementById("id_name").disabled = false;
      setTimeout("send()",1);
    }
  }
   function send() { 
    document.getElementById("assets_history_form").submit();
   }
  </script>
  {% endif %}
{% endblock content %}
